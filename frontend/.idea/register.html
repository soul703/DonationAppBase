<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÄÄƒng KÃ½ TÃ i Khoáº£n</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“</text></svg>">
</head>
<body>
<header class="main-header">
  <a href="/" class="logo">DonationApp</a>
</header>

<div class="container" style="max-width: 500px; margin-top: 50px;">
  <div class="detail-sidebar">
    <h2>Táº¡o tÃ i khoáº£n má»›i</h2>
    <p>CÃ¹ng chung tay vÃ¬ cá»™ng Ä‘á»“ng vá»›i chÃºng tÃ´i!</p>
    <hr>

    <form id="registerForm">
      <div class="form-group">
        <label for="userName">TÃªn Ä‘Äƒng nháº­p *</label>
        <input type="text" id="userName" name="userName" required minlength="3">
      </div>
      <div class="form-group">
        <label for="password">Máº­t kháº©u *</label>
        <input type="password" id="password" name="password" required minlength="8">
      </div>
      <div class="form-group">
        <label for="fullName">Há» vÃ  TÃªn *</label>
        <input type="text" id="fullName" name="fullName" required>
      </div>
      <div class="form-group">
        <label for="email">Email *</label>
        <input type="email" id="email" name="email" required>
      </div>
      <div class="form-group">
        <label for="phoneNumber">Sá»‘ Ä‘iá»‡n thoáº¡i</label>
        <input type="tel" id="phoneNumber" name="phoneNumber">
      </div>
      <div class="form-group">
        <label for="address">Äá»‹a chá»‰</label>
        <input type="text" id="address" name="address">
      </div>

      <button type="submit" id="submitBtn" class="btn btn-primary" style="width:100%;">ÄÄƒng KÃ½</button>
    </form>
    <p style="text-align: center; margin-top: 20px;">
      ÄÃ£ cÃ³ tÃ i khoáº£n? <a href="/login.html">ÄÄƒng nháº­p táº¡i Ä‘Ã¢y</a>
    </p>
  </div>
</div>

<div id="toast-container"></div>
<script src="js/app.js"></script>
<script>
  document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault(); // NgÄƒn form táº£i láº¡i trang

    const form = e.target;
    const submitButton = document.getElementById('submitBtn');
    submitButton.disabled = true;
    submitButton.textContent = 'Äang xá»­ lÃ½...';

    // Táº¡o Ä‘á»‘i tÆ°á»£ng body request tá»« dá»¯ liá»‡u form
    const requestBody = {
      userName: form.userName.value,
      password: form.password.value,
      fullName: form.fullName.value,
      email: form.email.value,
      phoneNumber: form.phoneNumber.value,
      address: form.address.value,
      // GÃ¡n roleId máº·c Ä‘á»‹nh lÃ  2 (ROLE_USER) cho ngÆ°á»i dÃ¹ng má»›i Ä‘Äƒng kÃ½
      roleId: 2
    };

    try {
      // Gá»i API POST /users Ä‘á»ƒ táº¡o ngÆ°á»i dÃ¹ng má»›i
      const response = await fetch(`${API_BASE_URL}/users`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestBody)
      });

      const apiResponse = await response.json();

      // Kiá»ƒm tra xem request cÃ³ thÃ nh cÃ´ng khÃ´ng
      if (response.ok && apiResponse.status === 'SUCCESS') {
        showToast('ÄÄƒng kÃ½ thÃ nh cÃ´ng! Báº¡n sáº½ Ä‘Æ°á»£c chuyá»ƒn Ä‘áº¿n trang Ä‘Äƒng nháº­p.');
        // Chá» má»™t chÃºt rá»“i chuyá»ƒn hÆ°á»›ng ngÆ°á»i dÃ¹ng Ä‘áº¿n trang Ä‘Äƒng nháº­p
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 2000);
      } else {
        // Náº¿u cÃ³ lá»—i tá»« server (validation, username/email Ä‘Ã£ tá»“n táº¡i,...)
        // thÃ¬ nÃ©m ra lá»—i Ä‘á»ƒ khá»‘i catch xá»­ lÃ½
        const errorMsg = apiResponse.errors ? JSON.stringify(apiResponse.errors) : apiResponse.message;
        throw new Error(errorMsg);
      }
    } catch (error) {
      // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i cho ngÆ°á»i dÃ¹ng
      showToast(`ÄÄƒng kÃ½ tháº¥t báº¡i: ${error.message}`, true);
    } finally {
      // Báº­t láº¡i nÃºt submit dÃ¹ thÃ nh cÃ´ng hay tháº¥t báº¡i
      submitButton.disabled = false;
      submitButton.textContent = 'ÄÄƒng KÃ½';
    }
  });
</script>
</body>
</html>